<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora D√≥lar-Bol√≠vares</title>
    <link rel="icon" href="https://upload.wikimedia.org/wikipedia/commons/thumb/1/14/Dollar_Sign.svg/800px-Dollar_Sign.svg.png">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="flag"></div>
            <h1 class="title" id="titleElement">
            <span class="dollar-icon">$</span>
            Calculadora
            <span class="dollar-icon">$</span>
        </h1>
            <p class="subtitle">Convertidor D√≥lar ‚áÑ Bol√≠vares</p>
        </div>

        <div id="content">
            <div class="loading">
                <div class="spinner"></div>
                Obteniendo tasa actual...
            </div>
        </div>

        <button class="refresh-btn" onclick="loadRate()" id="refreshBtn" style="display: none;">
            üîÑ Actualizar Tasa
        </button>

        <div class="last-update" id="lastUpdate"></div>
    </div>

    <script>
        let currentRate = 0;
        let isUsdToBs = false; // false = Bs to USD, true = USD to Bs

        function formatDate(dateString) {
            const date = new Date(dateString);
            return date.toLocaleDateString('es-VE', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }

        function formatCurrency(value, currency = 'Bs') {
            const formatted = new Intl.NumberFormat('es-VE', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(value);
            return currency === 'USD' ? `$${formatted}` : `Bs. ${formatted}`;
        }

        function calculateConversion(amount) {
            if (isUsdToBs) {
                // USD to Bs
                return amount * currentRate;
            } else {
                // Bs to USD
                return amount / currentRate;
            }
        }

        function updateConversion() {
            const input = document.getElementById('amountInput');
            const resultValue = document.getElementById('resultValue');
            const amount = parseFloat(input.value) || 0;
            
            if (amount === 0) {
                resultValue.textContent = formatCurrency(0, isUsdToBs ? 'Bs' : 'USD');
                return;
            }

            const result = calculateConversion(amount);
            resultValue.textContent = formatCurrency(result, isUsdToBs ? 'Bs' : 'USD');
        }

        function swapCurrencies() {
            isUsdToBs = !isUsdToBs;
            
            // Update labels
            const fromCurrency = document.getElementById('fromCurrency');
            const toCurrency = document.getElementById('toCurrency');
            const resultLabel = document.getElementById('resultLabel');
            const inputPlaceholder = document.getElementById('amountInput');
            
            if (isUsdToBs) {
                fromCurrency.textContent = 'USD';
                toCurrency.textContent = 'Bs';
                resultLabel.textContent = 'Equivale en Bol√≠vares:';
                inputPlaceholder.placeholder = 'Ingresa los d√≥lares';
            } else {
                fromCurrency.textContent = 'Bs';
                toCurrency.textContent = 'USD';
                resultLabel.textContent = 'Equivale en D√≥lares:';
                inputPlaceholder.placeholder = 'Ingresa los bol√≠vares';
            }
            
            // Update conversion
            updateConversion();
        }

        function renderCalculator(rate) {
            const content = document.getElementById('content');
            const lastUpdate = document.getElementById('lastUpdate');
            const refreshBtn = document.getElementById('refreshBtn');

            currentRate = rate.promedio;
            
            content.innerHTML = `
                <div class="calculator-container">
                    <div class="conversion-header">
                        <span class="currency-label" id="fromCurrency">Bs</span>
                        <button class="swap-btn" onclick="swapCurrencies()">‚áÑ</button>
                        <span class="currency-label" id="toCurrency">USD</span>
                    </div>
                    
                    <div class="input-container">
                        <input 
                            type="number" 
                            class="amount-input" 
                            id="amountInput" 
                            placeholder="Ingresa los bol√≠vares"
                            step="0.01"
                            oninput="updateConversion()"
                        >
                    </div>
                    
                    <div class="result-container">
                        <div class="result-label" id="resultLabel">Equivale en D√≥lares:</div>
                        <div class="result-value" id="resultValue">$0.00</div>
                    </div>
                </div>
                
                <div class="rate-display">
                    1 USD = Bs. ${formatCurrency(currentRate).replace('Bs. ', '')}
                </div>
            `;
            
            lastUpdate.textContent = `√öltima actualizaci√≥n: ${formatDate(rate.fechaActualizacion)}`;
            refreshBtn.style.display = 'inline-block';

            document.getElementById('titleElement').innerHTML = `
                <span class="dollar-icon">$</span>
                Calculadora ${rate.nombre}
                <span class="dollar-icon">$</span>
            `;

        }
//Mostrar Error
        function showError(message) {
            const content = document.getElementById('content');
            const refreshBtn = document.getElementById('refreshBtn');
            
            content.innerHTML = `
                <div class="error">
                    ‚ö†Ô∏è Error: ${message}
                </div>
            `;
            refreshBtn.style.display = 'inline-block';
        }

        async function loadRate() {
            const content = document.getElementById('content');
            const refreshBtn = document.getElementById('refreshBtn');
            
            content.innerHTML = `
                <div class="loading">
                    <div class="spinner"></div>
                    Obteniendo tasa actual...
                </div>
            `;
            refreshBtn.style.display = 'none';

            try {
                const response = await fetch('https://ve.dolarapi.com/v1/dolares/oficial');
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                if (!data || !data.promedio) {
                    throw new Error('No se recibieron datos v√°lidos de la API');
                }
                
                renderCalculator(data);
                
            } catch (error) {
                console.error('Error al cargar la tasa:', error);
                showError('No se pudo cargar la tasa del d√≥lar. Verifica tu conexi√≥n a internet.');
            }
        }

        // Cargar la tasa al iniciar la p√°gina
        document.addEventListener('DOMContentLoaded', loadRate);

        // Auto-actualizar cada 10 minutos
        setInterval(loadRate, 10 * 60 * 1000);
    </script>
</body>

</html>

